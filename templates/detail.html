{% extends 'base.html' %} 
{% import 'common.jinja' as common with context %}

{% set row = g.result[0] %}

{% if not erase_verb %}
  {% set erase_verb = 'Eliminar' %}
{% endif %}

{% block content %}

{% if not non_erasable %}
<script>
function erase() {
	Popup(stringToHTML(`
		<form method=POST style="display:flex;align-items:center;flex-direction:column">
			<h2>Â¿Esta seguro que deseea {{ erase_verb|lower }} {{ "el" if table[-1] != "a" else "la" }} {{ table|lower }}?</h2> 
			<input type=hidden name=action value=delete />
			<div style=display:flex;justify-content:space-evenly;align-items:center;align-self:stretch>
				<button class=boton onclick="removePopup()">Cancelar</button>
				<input class=boton type=submit value="Confirmar" />
			</div>
		</form>
	`))
}
</script>
{% endif %}

<h1>{{ g.title }}</h1>
<div class="item-info-container">
	<div class=item-info>
		{% block info %}
		<img src="static/{{ row[image_index] or default_image if image_index else default_image }}" class="big-img" />
		<div class="item-description" style="margin-bottom: auto; text-align: center">
			{% for field in [fields, "main"]|show %}
				<h3>{{ [row, field, fields]|format }}</h3>
			{% endfor %}
			{% for field in [fields, "secondary"]|show %}
				<h4>{{ [row, field, fields]|format }}</h4>
			{% endfor %}
		</div>
		<div class=item-info-options>
		{% if not non_erasable %}
			<button onclick="erase()" class=boton>{{ erase_verb }} {{ table }}</button>
		{% endif %}
		{% block options %}{% endblock %}
		</div>
		{% endblock %}
	</div>
	
	{% block info_fields %}
	{% if non_editable %}
		<div class="form">
			<h3>Datos</h3>
			<div class=item-fields>
			{% for field in fields if not ((page_type == "edit" and "key" in field) or ("info" in field)) %}
				<div class=item-field>
					<h4>{{ field["label"] }}</h4>
				  <div>{{ row[[fields, field]|index]|limit_decimal }}</div>
				</div>
			{% endfor %}
			</div>
		</div>
	{% else %}
		<form class="form" method="POST" enctype="multipart/form-data">
			{{ common.field_form(fields, row) }}
			<input type=hidden name=action value=update />
			<input class=boton type=submit value="Editar {{ table }}" />
		</form>
	{% endif %}
	{% endblock %}
</div>
{% endblock %}
